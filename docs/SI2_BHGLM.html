<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-99.9.9">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Supplementary Information: Trophic assessment of three sympatric batoid species in the GC - 2&nbsp; Hierarchical Bayesian Models to describe differences in isotopic values between and within species</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./SI3_SIBER.html" rel="next">
<link href="./SI1_ML_counts.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Hierarchical Bayesian Models to describe differences in isotopic values between and within species</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Supplementary Information: Trophic assessment of three sympatric batoid species in the GC</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/ArturoBell/01072022" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Code and data</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./SI1_ML_counts.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">ML approach to classify species based on prey weights</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./SI2_BHGLM.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Hierarchical Bayesian Models to describe differences in isotopic values between and within species</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./SI3_SIBER.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Amplitudes and comparisons of the isotopic niches</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./SI4_nicheROVER.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Isotopic niche overlaps</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#imports" id="toc-imports" class="nav-link active" data-scroll-target="#imports"><span class="toc-section-number">2.1</span>  Imports</a>
  <ul class="collapse">
  <li><a href="#miscelaneous-configurations" id="toc-miscelaneous-configurations" class="nav-link" data-scroll-target="#miscelaneous-configurations"><span class="toc-section-number">2.1.1</span>  Miscelaneous configurations</a></li>
  </ul></li>
  <li><a href="#exploratory-data-analyses" id="toc-exploratory-data-analyses" class="nav-link" data-scroll-target="#exploratory-data-analyses"><span class="toc-section-number">2.2</span>  Exploratory Data Analyses</a>
  <ul class="collapse">
  <li><a href="#data-description" id="toc-data-description" class="nav-link" data-scroll-target="#data-description"><span class="toc-section-number">2.2.1</span>  Data description</a></li>
  </ul></li>
  <li><a href="#justification-of-methods" id="toc-justification-of-methods" class="nav-link" data-scroll-target="#justification-of-methods"><span class="toc-section-number">2.3</span>  Justification of methods</a></li>
  <li><a href="#comparisons-of-means-and-effects-of-predictors" id="toc-comparisons-of-means-and-effects-of-predictors" class="nav-link" data-scroll-target="#comparisons-of-means-and-effects-of-predictors"><span class="toc-section-number">2.4</span>  Comparisons of means and effects of predictors </a><a class="anchor nav-link" id="hierbiv" data-scroll-target="undefined"></a>
  <ul class="collapse">
  <li><a href="#diagnostics" id="toc-diagnostics" class="nav-link" data-scroll-target="#diagnostics"><span class="toc-section-number">2.4.1</span>  Diagnostics </a><a class="anchor nav-link" id="diags" data-scroll-target="undefined"></a></li>
  </ul></li>
  <li><a href="#a-note-on-the-interpretation-of-results" id="toc-a-note-on-the-interpretation-of-results" class="nav-link" data-scroll-target="#a-note-on-the-interpretation-of-results"><span class="toc-section-number">2.5</span>  A note on the interpretation of results </a><a class="anchor nav-link" id="interp" data-scroll-target="undefined"></a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results"><span class="toc-section-number">2.6</span>  Results </a><a class="anchor nav-link" id="resdes" data-scroll-target="undefined"></a>
  <ul class="collapse">
  <li><a href="#dummy-variables" id="toc-dummy-variables" class="nav-link" data-scroll-target="#dummy-variables"><span class="toc-section-number">2.6.1</span>  Dummy variables</a></li>
  <li><a href="#isotopic-means" id="toc-isotopic-means" class="nav-link" data-scroll-target="#isotopic-means"><span class="toc-section-number">2.6.2</span>  Isotopic means</a></li>
  <li><a href="#effect-of-the-sex" id="toc-effect-of-the-sex" class="nav-link" data-scroll-target="#effect-of-the-sex"><span class="toc-section-number">2.6.3</span>  Effect of the sex</a></li>
  <li><a href="#effect-of-the-season" id="toc-effect-of-the-season" class="nav-link" data-scroll-target="#effect-of-the-season"><span class="toc-section-number">2.6.4</span>  Effect of the season</a></li>
  <li><a href="#effect-of-the-maturity-stage" id="toc-effect-of-the-maturity-stage" class="nav-link" data-scroll-target="#effect-of-the-maturity-stage"><span class="toc-section-number">2.6.5</span>  Effect of the maturity stage</a></li>
  <li><a href="#inference" id="toc-inference" class="nav-link" data-scroll-target="#inference"><span class="toc-section-number">2.6.6</span>  Inference </a><a class="anchor nav-link" id="inferences" data-scroll-target="undefined"></a></li>
  <li><a href="#together" id="toc-together" class="nav-link" data-scroll-target="#together"><span class="toc-section-number">2.6.7</span>  Together</a></li>
  <li><a href="#bivariate-posterior-distribution" id="toc-bivariate-posterior-distribution" class="nav-link" data-scroll-target="#bivariate-posterior-distribution"><span class="toc-section-number">2.6.8</span>  Bivariate Posterior Distribution </a><a class="anchor nav-link" id="PosteriorJoint" data-scroll-target="undefined"></a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/ArturoBell/01072022/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Hierarchical Bayesian Models to describe differences in isotopic values between and within species</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="imports" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="imports"><span class="header-section-number">2.1</span> Imports</h2>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> theano</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymc3 <span class="im">as</span> pm</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> arviz <span class="im">as</span> az</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> multiprocessing <span class="im">as</span> mp</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> theano <span class="im">import</span> tensor <span class="im">as</span> tt</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> threadpoolctl <span class="im">import</span> threadpool_limits</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="miscelaneous-configurations" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="miscelaneous-configurations"><span class="header-section-number">2.1.1</span> Miscelaneous configurations</h3>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>env THEANO_FLAGS<span class="op">=</span>device<span class="op">=</span>cpu,floatX<span class="op">=</span>float32</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>env OMP_NUM_THREADS<span class="op">=</span><span class="dv">1</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#%env MKL_NUM_THREADS=1</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>config InlineBackend.figure_format <span class="op">=</span> <span class="st">'retina'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>env: THEANO_FLAGS=device=cpu,floatX=float32
env: OMP_NUM_THREADS=1</code></pre>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'font.family'</span>] <span class="op">=</span> <span class="st">'Serif'</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> plt.rcParams[<span class="st">'axes.prop_cycle'</span>].by_key()[<span class="st">'color'</span>]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'font.size'</span>] <span class="op">=</span> <span class="dv">12</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> <span class="st">'output/HBGLM'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="exploratory-data-analyses" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="exploratory-data-analyses"><span class="header-section-number">2.2</span> Exploratory Data Analyses</h2>
<p>Loading the data from the <code>glm.csv</code> file:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading the data and renaming some columns</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>col_names <span class="op">=</span> {<span class="st">'sexo'</span>: <span class="st">'Sex'</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">'temporada'</span>: <span class="st">'Season'</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">'estadio'</span>:<span class="st">'Maturity'</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">'sp'</span>: <span class="st">'Species'</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">'year'</span>: <span class="st">'Year'</span>}</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop unused columns and missing data</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>glm_data <span class="op">=</span> pd.read_csv(<span class="st">'data/glm.csv'</span>).rename(columns <span class="op">=</span> col_names).dropna()</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Translating field values to spanish keys</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>glm_data.Sex <span class="op">=</span> glm_data.Sex.<span class="bu">map</span>({<span class="st">'M'</span>:<span class="st">'Male'</span>, <span class="st">'H'</span>: <span class="st">'Female'</span>})</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>glm_data.Season <span class="op">=</span> glm_data.Season.<span class="bu">map</span>({<span class="st">'Calida'</span>: <span class="st">'Warm'</span>, <span class="st">'Fria'</span>: <span class="st">'Cold'</span>})</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>glm_data.Maturity <span class="op">=</span> glm_data.Maturity.<span class="bu">map</span>({<span class="st">'Adulto'</span>: <span class="st">'Adult'</span>, <span class="st">'Juvenil'</span>: <span class="st">'Juvenile'</span>})</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy of the original dataset, before coding any dummy variables</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>ref_data <span class="op">=</span> glm_data.copy()</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview of the data</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>glm_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe table table-sm table-striped" data-border="1">
<thead>
<tr class="header">
<th></th>
<th>Species</th>
<th>Year</th>
<th>Season</th>
<th>Sex</th>
<th>Maturity</th>
<th>d15n</th>
<th>d13c</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th>0</th>
<td>H.dipterurus</td>
<td>2015</td>
<td>Warm</td>
<td>Male</td>
<td>Juvenile</td>
<td>16.301217</td>
<td>-14.506785</td>
</tr>
<tr class="even">
<th>1</th>
<td>H.dipterurus</td>
<td>2015</td>
<td>Warm</td>
<td>Female</td>
<td>Juvenile</td>
<td>16.832374</td>
<td>-17.810405</td>
</tr>
<tr class="odd">
<th>2</th>
<td>H.dipterurus</td>
<td>2015</td>
<td>Warm</td>
<td>Male</td>
<td>Adult</td>
<td>17.135463</td>
<td>-15.831434</td>
</tr>
<tr class="even">
<th>3</th>
<td>H.dipterurus</td>
<td>2015</td>
<td>Warm</td>
<td>Female</td>
<td>Juvenile</td>
<td>13.123093</td>
<td>-15.965960</td>
</tr>
<tr class="odd">
<th>4</th>
<td>H.dipterurus</td>
<td>2015</td>
<td>Warm</td>
<td>Male</td>
<td>Adult</td>
<td>17.633117</td>
<td>-16.719438</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="data-description" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="data-description"><span class="header-section-number">2.2.1</span> Data description</h3>
<p>In <a href="#fig-pairplot">Figure&nbsp;<span>2.1</span></a> we can observe that:</p>
<ol type="1">
<li><p>There is an isotopic gradient between the three species in both isotopes: <em>R. steindachneri</em> &lt; <em>H. dipterurus</em> &lt; <em>N. entemedor</em>.</p></li>
<li><p>This gradient is consistent, to different extents, through the covariates, causing deviations from the statistic normality, especially in multivariate terms.</p></li>
<li><p>Some classes are misrepresented in relation to anothers</p></li>
</ol>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable coding:</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Sex</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>n_sex <span class="op">=</span> <span class="bu">len</span>(glm_data.Sex.unique()) <span class="co"># Número de categorías (2, evidentemente)</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>glm_data[<span class="st">'Sex'</span>] <span class="op">=</span> pd.Categorical(glm_data[<span class="st">'Sex'</span>]).codes <span class="co"># Se transforma a 0 y 1</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>sex_idx <span class="op">=</span> glm_data.Sex.values <span class="co"># Se extraen los identificadores</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Season</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>n_season <span class="op">=</span> <span class="bu">len</span>(glm_data.Season.unique())</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>glm_data[<span class="st">'Season'</span>] <span class="op">=</span> pd.Categorical(glm_data[<span class="st">'Season'</span>]).codes</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>sex_idx <span class="op">=</span> glm_data.Season.values</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Age</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>n_mat <span class="op">=</span> <span class="bu">len</span>(glm_data.Maturity.unique())</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>glm_data[<span class="st">'Maturity'</span>] <span class="op">=</span> pd.Categorical(glm_data[<span class="st">'Maturity'</span>]).codes</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>sex_idx <span class="op">=</span> glm_data.Maturity.values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> sns.pairplot(glm_data, hue <span class="op">=</span> <span class="st">'Species'</span>, palette <span class="op">=</span> colors[<span class="dv">0</span>:<span class="dv">3</span>], corner <span class="op">=</span> <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-pairplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="SI2_BHGLM_files/figure-html/fig-pairplot-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2.1: Pairplot of isotopic data and covariates</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>It is important to mention that the <code>year</code> variable has two levels only for <em>R. steindachneri</em> and will, hence, be discarded from the analysis. The sample sizes per species-class pair are:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ref_data.groupby(<span class="st">'Species'</span>).agg({<span class="st">'d13c'</span>: <span class="st">'count'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe table table-sm table-striped" data-border="1">
<thead>
<tr class="header">
<th></th>
<th>d13c</th>
</tr>
<tr class="odd">
<th>Species</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th>H.dipterurus</th>
<td>81</td>
</tr>
<tr class="even">
<th>N.entemedor</th>
<td>69</td>
</tr>
<tr class="odd">
<th>R.steindachneri</th>
<td>74</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>ref_data.groupby([<span class="st">'Species'</span>, <span class="st">'Season'</span>]).agg({<span class="st">'d13c'</span>: <span class="st">'count'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe table table-sm table-striped" data-border="1">
<thead>
<tr class="header">
<th></th>
<th></th>
<th>d13c</th>
</tr>
<tr class="odd">
<th>Species</th>
<th>Season</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th rowspan="2" data-valign="top">H.dipterurus</th>
<th>Cold</th>
<td>18</td>
</tr>
<tr class="even">
<th>Warm</th>
<td>63</td>
</tr>
<tr class="odd">
<th rowspan="2" data-valign="top">N.entemedor</th>
<th>Cold</th>
<td>15</td>
</tr>
<tr class="even">
<th>Warm</th>
<td>54</td>
</tr>
<tr class="odd">
<th rowspan="2" data-valign="top">R.steindachneri</th>
<th>Cold</th>
<td>3</td>
</tr>
<tr class="even">
<th>Warm</th>
<td>71</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ref_data.groupby([<span class="st">'Species'</span>, <span class="st">'Sex'</span>]).agg({<span class="st">'d13c'</span>: <span class="st">'count'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe table table-sm table-striped" data-border="1">
<thead>
<tr class="header">
<th></th>
<th></th>
<th>d13c</th>
</tr>
<tr class="odd">
<th>Species</th>
<th>Sex</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th rowspan="2" data-valign="top">H.dipterurus</th>
<th>Female</th>
<td>44</td>
</tr>
<tr class="even">
<th>Male</th>
<td>37</td>
</tr>
<tr class="odd">
<th rowspan="2" data-valign="top">N.entemedor</th>
<th>Female</th>
<td>55</td>
</tr>
<tr class="even">
<th>Male</th>
<td>14</td>
</tr>
<tr class="odd">
<th rowspan="2" data-valign="top">R.steindachneri</th>
<th>Female</th>
<td>31</td>
</tr>
<tr class="even">
<th>Male</th>
<td>43</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>ref_data.groupby([<span class="st">'Species'</span>, <span class="st">'Maturity'</span>]).agg({<span class="st">'d13c'</span>: <span class="st">'count'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe table table-sm table-striped" data-border="1">
<thead>
<tr class="header">
<th></th>
<th></th>
<th>d13c</th>
</tr>
<tr class="odd">
<th>Species</th>
<th>Maturity</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th rowspan="2" data-valign="top">H.dipterurus</th>
<th>Adult</th>
<td>36</td>
</tr>
<tr class="even">
<th>Juvenile</th>
<td>45</td>
</tr>
<tr class="odd">
<th rowspan="2" data-valign="top">N.entemedor</th>
<th>Adult</th>
<td>55</td>
</tr>
<tr class="even">
<th>Juvenile</th>
<td>14</td>
</tr>
<tr class="odd">
<th rowspan="2" data-valign="top">R.steindachneri</th>
<th>Adult</th>
<td>26</td>
</tr>
<tr class="even">
<th>Juvenile</th>
<td>48</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>And for every possible combination:</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ref_data.groupby([<span class="st">'Species'</span>, <span class="st">'Season'</span>, <span class="st">'Sex'</span>, <span class="st">'Maturity'</span>]).agg({<span class="st">'d13c'</span>:<span class="st">'count'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe table table-sm table-striped" data-border="1">
<thead>
<tr class="header">
<th></th>
<th></th>
<th></th>
<th></th>
<th>d13c</th>
</tr>
<tr class="odd">
<th>Species</th>
<th>Season</th>
<th>Sex</th>
<th>Maturity</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th rowspan="8" data-valign="top">H.dipterurus</th>
<th rowspan="4" data-valign="top">Cold</th>
<th rowspan="2" data-valign="top">Female</th>
<th>Adult</th>
<td>3</td>
</tr>
<tr class="even">
<th>Juvenile</th>
<td>9</td>
</tr>
<tr class="odd">
<th rowspan="2" data-valign="top">Male</th>
<th>Adult</th>
<td>2</td>
</tr>
<tr class="even">
<th>Juvenile</th>
<td>4</td>
</tr>
<tr class="odd">
<th rowspan="4" data-valign="top">Warm</th>
<th rowspan="2" data-valign="top">Female</th>
<th>Adult</th>
<td>9</td>
</tr>
<tr class="even">
<th>Juvenile</th>
<td>23</td>
</tr>
<tr class="odd">
<th rowspan="2" data-valign="top">Male</th>
<th>Adult</th>
<td>22</td>
</tr>
<tr class="even">
<th>Juvenile</th>
<td>9</td>
</tr>
<tr class="odd">
<th rowspan="6" data-valign="top">N.entemedor</th>
<th rowspan="2" data-valign="top">Cold</th>
<th rowspan="2" data-valign="top">Female</th>
<th>Adult</th>
<td>13</td>
</tr>
<tr class="even">
<th>Juvenile</th>
<td>2</td>
</tr>
<tr class="odd">
<th rowspan="4" data-valign="top">Warm</th>
<th rowspan="2" data-valign="top">Female</th>
<th>Adult</th>
<td>30</td>
</tr>
<tr class="even">
<th>Juvenile</th>
<td>10</td>
</tr>
<tr class="odd">
<th rowspan="2" data-valign="top">Male</th>
<th>Adult</th>
<td>12</td>
</tr>
<tr class="even">
<th>Juvenile</th>
<td>2</td>
</tr>
<tr class="odd">
<th rowspan="7" data-valign="top">R.steindachneri</th>
<th rowspan="3" data-valign="top">Cold</th>
<th>Female</th>
<th>Juvenile</th>
<td>1</td>
</tr>
<tr class="even">
<th rowspan="2" data-valign="top">Male</th>
<th>Adult</th>
<td>1</td>
</tr>
<tr class="odd">
<th>Juvenile</th>
<td>1</td>
</tr>
<tr class="even">
<th rowspan="4" data-valign="top">Warm</th>
<th rowspan="2" data-valign="top">Female</th>
<th>Adult</th>
<td>5</td>
</tr>
<tr class="odd">
<th>Juvenile</th>
<td>25</td>
</tr>
<tr class="even">
<th rowspan="2" data-valign="top">Male</th>
<th>Adult</th>
<td>20</td>
</tr>
<tr class="odd">
<th>Juvenile</th>
<td>21</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Species</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>n_sp <span class="op">=</span> <span class="bu">len</span>(glm_data.Species.unique())</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>sp_names <span class="op">=</span> glm_data[<span class="st">'Species'</span>].unique()</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>glm_data[<span class="st">'Species'</span>] <span class="op">=</span> pd.Categorical(glm_data[<span class="st">'Species'</span>]).codes</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>sp_idx <span class="op">=</span> glm_data.Species.values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="justification-of-methods" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="justification-of-methods"><span class="header-section-number">2.3</span> Justification of methods</h2>
<p>Frequentist null hypothesis testing has been useful in ecological studies; however, it has been suggested that inferences should, instead, be made from models, likelihodd ratios or in probabilistic terms (<em>i.e.</em> Bayesian Inference <span class="citation" data-cites="Gerrodette_2011 Ellison_2004 HobbsHilborn_2006 Armheinetal_2019">(<a href="references.html#ref-Ellison_2004" role="doc-biblioref">Ellison 2004</a>, <a href="references.html#ref-HobbsHilborn_2006" role="doc-biblioref">Hobbs &amp; Hilborn 2006</a>, <a href="references.html#ref-Gerrodette_2011" role="doc-biblioref">Gerrodette 2011</a>, <a href="references.html#ref-Armheinetal_2019" role="doc-biblioref">Armhein et al. 2019</a>)</span>); hence, analyses were based on Bayesian Inference. In general, Bayesian Inference consists on the reallocation of credibility among a space of candidate possibilities, using the Bayes’ Theorem to evaluate the credibility of a parameter given the data and prior knowledge of the parameter <span class="citation" data-cites="Bolstad_2004 Kruschke_2015">(<a href="references.html#ref-Bolstad_2004" role="doc-biblioref">Bolstad 2004</a>, <a href="references.html#ref-Kruschke_2015" role="doc-biblioref">Kruschke 2015</a>)</span>. Details on the implementation of the models and the sampling of the posterior distributions are given in each section; however, each model was run until convergence; <em>i.e.</em>, 0 divergences during the posterior sampling and Gelman-Rubick statistics equal to 1.0 for every parameter. Other graphical diagnostics such as Posterior Predictive Checks and energy plots <span class="citation" data-cites="Betancourt_2017 Gabryetal_2017">(<a href="references.html#ref-Betancourt_2017" role="doc-biblioref">Betancourt 2017</a>, <a href="references.html#ref-Gabryetal_2017" role="doc-biblioref">Gabry et al. 2017</a>)</span> are also presented. Every sample after convergence (posterior) was kept. This approach was taken since thinning the posterior sample is unadvised, unless there are computational restrictions, due to a reduction in the precision of the estimates <span class="citation" data-cites="LinkEaton_2012 Stan_2022">(<a href="references.html#ref-LinkEaton_2012" role="doc-biblioref">Link &amp; Eaton 2012</a>, <a href="references.html#ref-Stan_2022" role="doc-biblioref">Team 2022</a>)</span>. Still, the number of posterior samples for each model was dependent on the number of independent samples (effective sample sizes, ess) being over 2000, both for bulk and tail ess <span class="citation" data-cites="Martin_2018">(affecting the reliability of the median and highest density intervals, respectively, <a href="references.html#ref-Martin_2018" role="doc-biblioref">Martin 2018</a>)</span>.</p>
</section>
<section id="comparisons-of-means-and-effects-of-predictors" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="comparisons-of-means-and-effects-of-predictors"><span class="header-section-number">2.4</span> Comparisons of means and effects of predictors <a class="anchor" id="hierbiv"></a></h2>
<p>The isotopic spaces of the three species were described using a custom hierarchichal bivariate model, in which the effects of the climatic seasons (warm vs.&nbsp;cold), sexes and age categories (juveniles vs.&nbsp;adults) on the isotopic values are nested within each species, meaning that the isotopic space of each species is the result of two linear models (one per isotopic ratio) of the covariates. This model was implemented using the <code>pymc3</code> library <span class="citation" data-cites="Salvatieretal_2016">(v. 3.11.2, <a href="references.html#ref-Salvatieretal_2016" role="doc-biblioref">Salvatier et al. 2016</a>)</span> in Python 3 <span class="citation" data-cites="VanRossumetal_2009">(v. 3.8.2, <a href="references.html#ref-VanRossumetal_2009" role="doc-biblioref">Van Rossum &amp; Drake 2009</a>)</span>, with three chains that were tuned for 25,000 iterations and a posterior sample of 2,000 iterations (draws). The model was specified as follows, where <span class="math inline">\(j\)</span> represents the isotopic ratio, <span class="math inline">\(i\)</span> the species, <span class="math inline">\(a\)</span> the intercept (<em>i.e.</em> the mean isotopic value) and <span class="math inline">\(b\)</span> the slopes of the regression (<em>i.e.</em> the difference between both levels of the covariates):</p>
<ul>
<li><strong>Hyper-priors</strong>
<ul>
<li><span class="math inline">\(\nu \sim Exponential(\lambda = 1/29)+1\)</span>: global degrees-of-freedom (d.f.). The shifted exponential distribution spreads the credibility both for nearly normal and heavy-tailed distributions <span class="citation" data-cites="Kruschke_2012">(<a href="references.html#ref-Kruschke_2012" role="doc-biblioref">Kruschke 2012</a>)</span>.</li>
<li><span class="math inline">\(\mu_j \sim StudentT(\mu = mean(data_j), \sigma = sd(data_j)*1000, \nu\)</span>): Global mean of each isotope, centered on the mean of the pooled data for each isotope and a standard deviation 1000 times that of the pooled data, with the previously described d.f.</li>
<li><span class="math inline">\(\sigma_{j,a} \sim HalfCauchy(\beta = 10)\)</span>: global standard deviation of the intercepts, following a non-commital Half-Cauchy distribution.</li>
<li><span class="math inline">\(\sigma_{j,b} \sim HalfCauchy(\beta = 10)\)</span>: global standard deviation of the slopes, with the same distribution as that of the intercepts.</li>
<li><span class="math inline">\(\mu_{j,b} \sim StudentT(\mu = 0, \sigma = 10, \nu)\)</span>: global mean of the slopes, following a non-commital Student-T distribution with the previouslu described d.f.</li>
</ul></li>
<li><strong>Parameter priors</strong>
<ul>
<li><span class="math inline">\(\nu_i \sim Exponential(\lambda = 1/29) + 1\)</span>: Degrees-of-Freedom for each species, with the same specification that the global d.f.</li>
<li><span class="math inline">\(Sigma_i \sim LKJCholesky(n = 2, \eta = 1, \sigma = HalfCauchy(\beta = 10))\)</span>: Covariance matrix for both isotopes for each species, following a Cholesky-decomposed LKJ prior with equi-probability for every matrix, and each standard deviation following a non-commital Half-Cauchy distribution. Used instead of the Wishart distribution due to its higher efficiency to compute when paired with a Cholesky decomposition <span class="citation" data-cites="Lewandowskietal_2009">(<a href="references.html#ref-Lewandowskietal_2009" role="doc-biblioref">Lewandowski et al. 2009</a>)</span>.</li>
<li><span class="math inline">\(\mu_{j,i} \sim StudentT(\mu = \mu_j, \sigma_{j,a}, \nu_i)\)</span>: Intercepts of the linear model for each species and isotopic ratio; <em>i.e.</em>, the mean of each isotopic ration with a standard daviation <span class="math inline">\(\sigma_{j,a}\)</span> and d.f. <span class="math inline">\(nu_i\)</span>.</li>
<li><span class="math inline">\(\beta_{j,b,i} \sim Laplace(\mu_{j,b,i}, b = \sigma_{j,i})\)</span>: Represents the slope for each isotope and species, following a Laplace distribution, which results in a L1 regularization (<em>i.e.</em> a “Bayesian Lasso” <span class="citation" data-cites="ParkCasella_2012">(<a href="references.html#ref-ParkCasella_2012" role="doc-biblioref">Park &amp; Casella 2012</a>)</span>), with parameters:
<ul>
<li><span class="math inline">\(\mu_{j,b,i} \sim StudentT(\mu_{j,b}, \sigma_{j,b}, \nu_i)\)</span>: distribution of means of the intercept for each isotopic ratio, following a Student T distribution with mean 0, standard deviation 10 and d.f. <span class="math inline">\(\nu_i\)</span>.</li>
<li><span class="math inline">\(\sigma_{n,j,i} \sim HalfCauchy(\beta = 10)\)</span>: scale of the Laplace distribution, following a non-commital Half-Caucy distribution.</li>
</ul></li>
</ul></li>
<li><strong>Likelihood model</strong>
<ul>
<li><span class="math inline">\(Y_i \sim MvStudentT(\mu = [y_{1,i}, y_{2,i}], \Sigma_i, \nu)\)</span>: The bivariate distribution of the isotopic values following a Multivariate Student T distribution, with covariance matrix <span class="math inline">\(\Sigma_i\)</span>, d.f. <span class="math inline">\(\nu\)</span> and means under the linear model:
<ul>
<li><span class="math inline">\(y_{j,i} = \mu_{j,i} + \beta_{1,j,i}*Sex + \beta_{2,j,i}*Season + \beta_{3,j,i}*Age\)</span></li>
</ul></li>
</ul></li>
</ul>
<p>This parametrization obeyed the following reasons: i) a bivariate model allows accounting for the covariation between bulk isotopic values, which is relevant since these depend both on the isotopic baseline and the trophic level; hence, having a joint distribution that is not orthogonal; and, ii) the distributions used have heavier tails than a normal distribution, which assigns a higher probability to extreme values and, thus, allows to make robust estimations of the parameters <span class="citation" data-cites="Kruschke_2012">(<a href="references.html#ref-Kruschke_2012" role="doc-biblioref">Kruschke 2012</a>)</span>.</p>
<div class="callout callout-style-default callout-important callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>There are some cases of class imbalance and small sample sizes. Hierarchical Bayesian models aid in propagating the uncertainty and make every sample “contribute” to every estimate (including those of other groups) due to the partial pooling of the data and the effect of shrinkage, minimizing the effect of small sample sizes. This effect is further minimized by the robust inference allowed by the Student t likelihood. Moreover, SIA integrates information over a time window, “reducing” (to some extent) the sample size needed to make inferences <span class="citation" data-cites="Jacksonetal_2011">(<a href="references.html#ref-Jacksonetal_2011" role="doc-biblioref">Jackson et al. 2011</a>)</span>. Nevertheless, neither Bayesian inference nor SIA can make information out of thin air, and the results for those groups should be carefuly interpreted.</p>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pm.Model() <span class="im">as</span> full_model:</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    obs <span class="op">=</span> glm_data[[<span class="st">'d13c'</span>, <span class="st">'d15n'</span>]].values</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">#----Hyper-priors----</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">## Degrees of freedom.</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Shifted exponential to spread the credibility among heavy-tailed</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (small d.f.) and light-tailed (d.f) distributions (normal-like)</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    nu <span class="op">=</span> pm.Exponential(<span class="st">'ν'</span>, lam <span class="op">=</span> <span class="dv">1</span><span class="op">/</span><span class="dv">29</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">## Mean Isotopic values ~ StudentT (Gaussian-like, heavier tails than a normal dist.)</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Centered on the global mean of each isotope to keep the distribution scaled</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Standard deviation: 1000 times the standard deviation of the pooled data</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># D.F.: Previously defined</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    µ<span class="dv">1</span> <span class="op">=</span> pm.StudentT(<span class="st">'δ13C'</span>, mu <span class="op">=</span> glm_data.d13c.mean(),</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>                     sd <span class="op">=</span> glm_data.d13c.std()<span class="op">*</span><span class="dv">1000</span>,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>                     nu <span class="op">=</span> nu)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    µ<span class="dv">2</span> <span class="op">=</span> pm.StudentT(<span class="st">'δ15N'</span>, mu <span class="op">=</span> glm_data.d15n.mean(),</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>                     sd <span class="op">=</span> glm_data.d15n.std()<span class="op">*</span><span class="dv">1000</span>,</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>                     nu <span class="op">=</span> nu)    </span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">## Parameters</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Standard deviation of the intercepts. Non-commital Half-Cauchy.</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    sigma_a <span class="op">=</span> pm.HalfCauchy(<span class="st">'sd_a'</span>, beta <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Standard deviation of the slopes. Non-commital Half-Cauchy.</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    sigma_b <span class="op">=</span> pm.HalfCauchy(<span class="st">'sd_b'</span>, beta <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># D.F. of the Distribution. Same parametrization as before.</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>    nu2 <span class="op">=</span> pm.Exponential(<span class="st">'nu_a'</span>, lam <span class="op">=</span> <span class="dv">1</span><span class="op">/</span><span class="dv">29</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Distribution of means of the slopes. Non-commital Student-T distribution.</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    mu_b <span class="op">=</span> pm.StudentT(<span class="st">'mu_b'</span>, mu <span class="op">=</span> <span class="dv">0</span>, sd <span class="op">=</span> <span class="dv">10</span>, nu <span class="op">=</span> nu)</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>    <span class="co">#----Priors on the parameters----</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">## Means: Student-T</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>    mu1 <span class="op">=</span> pm.StudentT(<span class="st">'µδ13C'</span>,</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>                      mu <span class="op">=</span> µ<span class="dv">1</span>,</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>                      sigma <span class="op">=</span> pm.HalfCauchy(<span class="st">'sδ13C'</span>, beta <span class="op">=</span> <span class="dv">10</span>),</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>                      nu <span class="op">=</span> nu2,</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>                      shape <span class="op">=</span> n_sp)</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>    mu2 <span class="op">=</span> pm.StudentT(<span class="st">'µδ15N'</span>,</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>                      mu <span class="op">=</span> µ<span class="dv">2</span>,</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>                      sigma <span class="op">=</span> pm.HalfCauchy(<span class="st">'sδ15N'</span>, beta <span class="op">=</span> <span class="dv">10</span>),</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>                      nu <span class="op">=</span> nu2,</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>                      shape <span class="op">=</span> n_sp)</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>    <span class="co">## Intercepts: Student-T distribution centered on global mean isotopic values</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>    a1 <span class="op">=</span> pm.StudentT(<span class="st">'⍺δ13C'</span>, mu <span class="op">=</span> µ<span class="dv">1</span>, sigma <span class="op">=</span> sigma_a, nu <span class="op">=</span> nu2, shape <span class="op">=</span> n_sp)</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>    a2 <span class="op">=</span> pm.StudentT(<span class="st">'⍺δ15N'</span>, mu <span class="op">=</span> µ<span class="dv">2</span>, sigma <span class="op">=</span> sigma_a, nu <span class="op">=</span> nu2, shape <span class="op">=</span> n_sp)</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>    <span class="co">## Slopes: Student T distribution   </span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>    <span class="co">## Slopes: Laplace distribution. </span></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Equivalent to a Lasso regression; i.e., L1 regularization.</span></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Affects the sum of absolutes of the residuals. The effect is that small effects -&gt; 0.</span></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Especially useful when considering the measuring error of the mass spectrometer.</span></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Main effects:</span></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sex:</span></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>    T_b1c <span class="op">=</span> pm.Laplace(<span class="st">'Sex_δ13C'</span>, mu <span class="op">=</span> mu_b, b <span class="op">=</span> sigma_b, shape <span class="op">=</span> n_sp)</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>    T_b1n <span class="op">=</span> pm.Laplace(<span class="st">'Sex_δ15N'</span>, mu <span class="op">=</span> mu_b, b <span class="op">=</span> sigma_b, shape <span class="op">=</span> n_sp)</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Season:</span></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>    T_b2c <span class="op">=</span> pm.Laplace(<span class="st">'Season_δ13C'</span>, mu <span class="op">=</span> mu_b, b <span class="op">=</span> sigma_b, shape <span class="op">=</span> n_sp)</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>    T_b2n <span class="op">=</span> pm.Laplace(<span class="st">'Season_δ15N'</span>, mu <span class="op">=</span> mu_b, b <span class="op">=</span> sigma_b, shape <span class="op">=</span> n_sp)</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Maturity stages:</span></span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>    T_b3c <span class="op">=</span> pm.Laplace(<span class="st">'Maturity_δ13C'</span>, mu <span class="op">=</span> mu_b, b <span class="op">=</span> sigma_b, shape <span class="op">=</span> n_sp)</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>    T_b3n <span class="op">=</span> pm.Laplace(<span class="st">'Maturity_δ15N'</span>, mu <span class="op">=</span> mu_b, b <span class="op">=</span> sigma_b, shape <span class="op">=</span> n_sp)</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>    <span class="co">## Covariance Matrix</span></span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># LKJ prior with eta = 1, meaning a uniform distribution of the whole matrix</span></span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prior of every sd: Non-commital Half-Cauchy</span></span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>    pL <span class="op">=</span> pm.LKJCholeskyCov(<span class="st">'pL'</span>, n <span class="op">=</span> <span class="dv">2</span>, eta <span class="op">=</span> <span class="dv">1</span>, </span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>                           sd_dist <span class="op">=</span> pm.HalfCauchy.dist(beta <span class="op">=</span> <span class="dv">10</span>), shape <span class="op">=</span> n_sp)</span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The LKJ distribution is decomposed by a Cholesky factor, so we decompose it:</span></span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>    L <span class="op">=</span> pm.expand_packed_triangular(<span class="dv">2</span>, pL)</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>    Σ <span class="op">=</span> pm.Deterministic(<span class="st">'Σ'</span>, L.dot(L.T))</span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>    <span class="co">#----Algebraic expression of the model----</span></span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Each isotope is a linear model with the effect of the covariates</span></span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a>    d13c <span class="op">=</span> a1[sp_idx] <span class="op">+\</span></span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a>           T_b1c[sp_idx]<span class="op">*</span>glm_data.Sex.values <span class="op">+\</span></span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a>           T_b2c[sp_idx]<span class="op">*</span>glm_data.Season.values <span class="op">+\</span></span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a>           T_b3c[sp_idx]<span class="op">*</span>glm_data.Maturity.values</span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a>    d15n <span class="op">=</span> a2[sp_idx] <span class="op">+\</span></span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a>           T_b1n[sp_idx]<span class="op">*</span>glm_data.Sex.values <span class="op">+\</span></span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a>           T_b2n[sp_idx]<span class="op">*</span>glm_data.Season.values <span class="op">+\</span></span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>           T_b3n[sp_idx]<span class="op">*</span>glm_data.Maturity.values</span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Bivariate tensor for the Likelihood model:</span></span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a>    glm <span class="op">=</span> tt.stack([d13c, d15n]).T</span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a>    mus <span class="op">=</span> tt.stack([mu1[sp_idx], mu2[sp_idx]]).T</span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a>    <span class="co">#----Likelihood model----</span></span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a>    <span class="co"># In this step the hierarchical estimates are included;</span></span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a>    <span class="co"># hence, it includes their uncertainty.</span></span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> pm.MvStudentT(<span class="st">'mvT_sp'</span>,</span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a>                      mu <span class="op">=</span> glm,<span class="co"># Linear model of each isotopes</span></span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a>                      cov <span class="op">=</span> Σ, <span class="co"># Covariance Matrix</span></span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a>                      nu <span class="op">=</span> nu, <span class="co"># Degrees of freedom</span></span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a>                      observed <span class="op">=</span> obs) <span class="co"># Observed data</span></span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a>    means <span class="op">=</span> pm.MvStudentT(<span class="st">'µ_sp'</span>,</span>
<span id="cb14-105"><a href="#cb14-105" aria-hidden="true" tabindex="-1"></a>                          mu <span class="op">=</span> mus,</span>
<span id="cb14-106"><a href="#cb14-106" aria-hidden="true" tabindex="-1"></a>                          cov <span class="op">=</span> Σ,</span>
<span id="cb14-107"><a href="#cb14-107" aria-hidden="true" tabindex="-1"></a>                          nu <span class="op">=</span> nu,</span>
<span id="cb14-108"><a href="#cb14-108" aria-hidden="true" tabindex="-1"></a>                          observed <span class="op">=</span> obs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Graph of the hierarchical model.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>pm.model_to_graphviz(full_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div id="fig-graph" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="SI2_BHGLM_files/figure-html/fig-graph-output-1.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2.2: Directed graph of the hierarchical model.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters of the NUTS.</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>tune <span class="op">=</span> <span class="dv">25000</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>draws <span class="op">=</span> <span class="dv">5000</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Variational Inference to start the sampling process</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>init <span class="op">=</span> <span class="st">'advi+adapt_diag'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Sampling of the posterior:</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> full_model:</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">#----Sampling----</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    full_trace <span class="op">=</span> pm.sample(draws <span class="op">=</span> draws, <span class="co"># Posterior samples to keep</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                           tune <span class="op">=</span> tune, <span class="co"># Burn-in iterations</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>                           chains <span class="op">=</span> <span class="dv">3</span>, <span class="co"># Number of chains</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                           cores <span class="op">=</span> <span class="dv">3</span>, <span class="co"># Number of chains run in parallel </span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>                           init <span class="op">=</span> init, <span class="co"># Initiation method,</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>                           return_inferencedata <span class="op">=</span> <span class="va">False</span>, <span class="co"># NOT return an arviz.InferenceData</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>                           random_seed <span class="op">=</span> <span class="dv">0</span>, <span class="co"># For consistency</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>                           progressbar <span class="op">=</span> <span class="va">False</span>) <span class="co"># NOT show a progress bar</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Auto-assigning NUTS sampler...
Initializing NUTS using advi+adapt_diag...
Convergence achieved at 19700
Interrupted at 19,699 [9%]: Average Loss = 1,722.9
Multiprocess sampling (3 chains in 3 jobs)
NUTS: [pL, Maturity_δ15N, Maturity_δ13C, Season_δ15N, Season_δ13C, Sex_δ15N, Sex_δ13C, ⍺δ15N, ⍺δ13C, µδ15N, sδ15N, µδ13C, sδ13C, mu_b, nu_a, sd_b, sd_a, δ15N, δ13C, ν]
Sampling 3 chains for 25_000 tune and 5_000 draw iterations (75_000 + 15_000 draws total) took 1038 seconds.</code></pre>
</div>
</div>
<section id="diagnostics" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="diagnostics"><span class="header-section-number">2.4.1</span> Diagnostics <a class="anchor" id="diags"></a></h3>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>full_mod <span class="op">=</span> az.from_pymc3(trace <span class="op">=</span> full_trace, model <span class="op">=</span> full_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save model</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">#with open(output_dir+'/model/az_model', 'wb') as model_file:</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">#    pickle.dump(full_mod, model_file)</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Save trace</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">#with open(output_dir+'/model/pm_trace', 'wb') as model_file:</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">#    pickle.dump(full_trace, model_file)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load model for consistency</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">#with open(output_dir+'/model/az_model', 'rb') as model_file:</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">#    full_mod = pickle.load(model_file)</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">#with open(output_dir+'/model/az_model', 'rb') as model_file:</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">#    full_trace = pickle.load(model_file)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Summary statistics of the posterior distributions of the parameters</strong>. Gelman-Statistic values equal to 1.0 (&lt; 1.01) and Effective Sample Sizes (both Bulk and Tail) over 2000 for every parameter.</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>az.summary(full_mod, hdi_prob <span class="op">=</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe table table-sm table-striped" data-border="1">
<thead>
<tr class="header">
<th></th>
<th>mean</th>
<th>sd</th>
<th>hdi_2.5%</th>
<th>hdi_97.5%</th>
<th>mcse_mean</th>
<th>mcse_sd</th>
<th>ess_bulk</th>
<th>ess_tail</th>
<th>r_hat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th>δ13C</th>
<td>-13.995</td>
<td>0.904</td>
<td>-15.885</td>
<td>-12.218</td>
<td>0.009</td>
<td>0.006</td>
<td>12202.0</td>
<td>8109.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<th>δ15N</th>
<td>16.508</td>
<td>0.764</td>
<td>14.956</td>
<td>17.988</td>
<td>0.008</td>
<td>0.005</td>
<td>11778.0</td>
<td>7825.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<th>mu_b</th>
<td>-0.111</td>
<td>0.145</td>
<td>-0.405</td>
<td>0.172</td>
<td>0.001</td>
<td>0.001</td>
<td>14501.0</td>
<td>9645.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<th>µδ13C[0]</th>
<td>-13.997</td>
<td>0.191</td>
<td>-14.370</td>
<td>-13.624</td>
<td>0.002</td>
<td>0.001</td>
<td>12398.0</td>
<td>11332.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<th>µδ13C[1]</th>
<td>-12.385</td>
<td>0.129</td>
<td>-12.630</td>
<td>-12.125</td>
<td>0.001</td>
<td>0.001</td>
<td>15640.0</td>
<td>11048.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<th>µδ13C[2]</th>
<td>-16.119</td>
<td>0.109</td>
<td>-16.338</td>
<td>-15.910</td>
<td>0.001</td>
<td>0.001</td>
<td>13528.0</td>
<td>11247.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<th>µδ15N[0]</th>
<td>16.161</td>
<td>0.149</td>
<td>15.869</td>
<td>16.452</td>
<td>0.001</td>
<td>0.001</td>
<td>12816.0</td>
<td>11541.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<th>µδ15N[1]</th>
<td>18.058</td>
<td>0.099</td>
<td>17.870</td>
<td>18.255</td>
<td>0.001</td>
<td>0.001</td>
<td>14475.0</td>
<td>11300.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<th>µδ15N[2]</th>
<td>16.179</td>
<td>0.087</td>
<td>16.006</td>
<td>16.344</td>
<td>0.001</td>
<td>0.001</td>
<td>12963.0</td>
<td>11430.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<th>⍺δ13C[0]</th>
<td>-14.028</td>
<td>0.480</td>
<td>-14.927</td>
<td>-13.065</td>
<td>0.006</td>
<td>0.004</td>
<td>7143.0</td>
<td>9346.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<th>⍺δ13C[1]</th>
<td>-12.158</td>
<td>0.227</td>
<td>-12.608</td>
<td>-11.715</td>
<td>0.002</td>
<td>0.002</td>
<td>9716.0</td>
<td>9840.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<th>⍺δ13C[2]</th>
<td>-15.529</td>
<td>0.483</td>
<td>-16.436</td>
<td>-14.538</td>
<td>0.006</td>
<td>0.004</td>
<td>6458.0</td>
<td>7192.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<th>⍺δ15N[0]</th>
<td>15.231</td>
<td>0.359</td>
<td>14.513</td>
<td>15.925</td>
<td>0.004</td>
<td>0.003</td>
<td>6816.0</td>
<td>9450.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<th>⍺δ15N[1]</th>
<td>17.788</td>
<td>0.200</td>
<td>17.400</td>
<td>18.180</td>
<td>0.002</td>
<td>0.002</td>
<td>8775.0</td>
<td>9503.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<th>⍺δ15N[2]</th>
<td>15.752</td>
<td>0.534</td>
<td>14.645</td>
<td>16.676</td>
<td>0.007</td>
<td>0.005</td>
<td>6350.0</td>
<td>8275.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<th>Sex_δ13C[0]</th>
<td>-0.302</td>
<td>0.272</td>
<td>-0.855</td>
<td>0.219</td>
<td>0.002</td>
<td>0.002</td>
<td>13199.0</td>
<td>10522.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<th>Sex_δ13C[1]</th>
<td>-0.134</td>
<td>0.272</td>
<td>-0.694</td>
<td>0.395</td>
<td>0.002</td>
<td>0.002</td>
<td>15605.0</td>
<td>10292.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<th>Sex_δ13C[2]</th>
<td>0.060</td>
<td>0.196</td>
<td>-0.315</td>
<td>0.456</td>
<td>0.002</td>
<td>0.001</td>
<td>14920.0</td>
<td>11701.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<th>Sex_δ15N[0]</th>
<td>-0.082</td>
<td>0.207</td>
<td>-0.472</td>
<td>0.341</td>
<td>0.002</td>
<td>0.001</td>
<td>11893.0</td>
<td>10560.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<th>Sex_δ15N[1]</th>
<td>-0.190</td>
<td>0.220</td>
<td>-0.635</td>
<td>0.238</td>
<td>0.002</td>
<td>0.002</td>
<td>15431.0</td>
<td>10737.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<th>Sex_δ15N[2]</th>
<td>-0.024</td>
<td>0.157</td>
<td>-0.333</td>
<td>0.286</td>
<td>0.001</td>
<td>0.001</td>
<td>16323.0</td>
<td>11103.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<th>Season_δ13C[0]</th>
<td>-0.728</td>
<td>0.371</td>
<td>-1.434</td>
<td>-0.017</td>
<td>0.004</td>
<td>0.003</td>
<td>9062.0</td>
<td>10988.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<th>Season_δ13C[1]</th>
<td>-0.203</td>
<td>0.254</td>
<td>-0.725</td>
<td>0.275</td>
<td>0.003</td>
<td>0.002</td>
<td>9764.0</td>
<td>9525.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<th>Season_δ13C[2]</th>
<td>-0.304</td>
<td>0.435</td>
<td>-1.218</td>
<td>0.529</td>
<td>0.005</td>
<td>0.004</td>
<td>7016.0</td>
<td>7164.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<th>Season_δ15N[0]</th>
<td>1.784</td>
<td>0.297</td>
<td>1.206</td>
<td>2.366</td>
<td>0.003</td>
<td>0.002</td>
<td>9305.0</td>
<td>10307.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<th>Season_δ15N[1]</th>
<td>0.458</td>
<td>0.229</td>
<td>0.022</td>
<td>0.922</td>
<td>0.002</td>
<td>0.002</td>
<td>8542.0</td>
<td>8725.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<th>Season_δ15N[2]</th>
<td>0.414</td>
<td>0.506</td>
<td>-0.441</td>
<td>1.468</td>
<td>0.006</td>
<td>0.005</td>
<td>6719.0</td>
<td>8149.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<th>Maturity_δ13C[0]</th>
<td>1.157</td>
<td>0.398</td>
<td>0.378</td>
<td>1.934</td>
<td>0.004</td>
<td>0.003</td>
<td>8695.0</td>
<td>10915.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<th>Maturity_δ13C[1]</th>
<td>-0.245</td>
<td>0.294</td>
<td>-0.841</td>
<td>0.329</td>
<td>0.003</td>
<td>0.002</td>
<td>13819.0</td>
<td>10579.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<th>Maturity_δ13C[2]</th>
<td>-0.463</td>
<td>0.218</td>
<td>-0.898</td>
<td>-0.053</td>
<td>0.002</td>
<td>0.001</td>
<td>13527.0</td>
<td>11509.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<th>Maturity_δ15N[0]</th>
<td>-0.897</td>
<td>0.279</td>
<td>-1.445</td>
<td>-0.350</td>
<td>0.003</td>
<td>0.002</td>
<td>8263.0</td>
<td>11065.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<th>Maturity_δ15N[1]</th>
<td>-0.389</td>
<td>0.238</td>
<td>-0.866</td>
<td>0.064</td>
<td>0.002</td>
<td>0.002</td>
<td>15017.0</td>
<td>10699.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<th>Maturity_δ15N[2]</th>
<td>0.022</td>
<td>0.170</td>
<td>-0.298</td>
<td>0.376</td>
<td>0.001</td>
<td>0.001</td>
<td>13985.0</td>
<td>11095.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<th>ν</th>
<td>1.559</td>
<td>0.340</td>
<td>0.924</td>
<td>2.229</td>
<td>0.003</td>
<td>0.002</td>
<td>9236.0</td>
<td>8727.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<th>sd_a</th>
<td>1.892</td>
<td>0.877</td>
<td>0.681</td>
<td>3.529</td>
<td>0.009</td>
<td>0.007</td>
<td>14428.0</td>
<td>9423.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<th>sd_b</th>
<td>0.546</td>
<td>0.168</td>
<td>0.274</td>
<td>0.884</td>
<td>0.002</td>
<td>0.001</td>
<td>8818.0</td>
<td>9953.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<th>nu_a</th>
<td>32.802</td>
<td>30.069</td>
<td>0.097</td>
<td>93.053</td>
<td>0.223</td>
<td>0.178</td>
<td>14556.0</td>
<td>8534.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<th>sδ13C</th>
<td>2.936</td>
<td>2.130</td>
<td>0.644</td>
<td>6.783</td>
<td>0.023</td>
<td>0.016</td>
<td>14702.0</td>
<td>8659.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<th>sδ15N</th>
<td>2.060</td>
<td>1.847</td>
<td>0.303</td>
<td>5.230</td>
<td>0.021</td>
<td>0.015</td>
<td>11879.0</td>
<td>7494.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<th>pL[0]</th>
<td>0.944</td>
<td>0.059</td>
<td>0.833</td>
<td>1.064</td>
<td>0.001</td>
<td>0.000</td>
<td>8645.0</td>
<td>9254.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<th>pL[1]</th>
<td>-0.471</td>
<td>0.044</td>
<td>-0.554</td>
<td>-0.381</td>
<td>0.000</td>
<td>0.000</td>
<td>11209.0</td>
<td>11333.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<th>pL[2]</th>
<td>0.560</td>
<td>0.035</td>
<td>0.492</td>
<td>0.628</td>
<td>0.000</td>
<td>0.000</td>
<td>9231.0</td>
<td>9005.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<th>Σ[0,0]</th>
<td>0.895</td>
<td>0.112</td>
<td>0.680</td>
<td>1.117</td>
<td>0.001</td>
<td>0.001</td>
<td>8645.0</td>
<td>9254.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<th>Σ[0,1]</th>
<td>-0.446</td>
<td>0.064</td>
<td>-0.573</td>
<td>-0.324</td>
<td>0.001</td>
<td>0.000</td>
<td>9200.0</td>
<td>9280.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<th>Σ[1,0]</th>
<td>-0.446</td>
<td>0.064</td>
<td>-0.573</td>
<td>-0.324</td>
<td>0.001</td>
<td>0.000</td>
<td>9200.0</td>
<td>9280.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<th>Σ[1,1]</th>
<td>0.538</td>
<td>0.068</td>
<td>0.405</td>
<td>0.670</td>
<td>0.001</td>
<td>0.001</td>
<td>7994.0</td>
<td>8217.0</td>
<td>1.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>pps <span class="op">=</span> pm.sample_posterior_predictive(trace <span class="op">=</span> full_trace,</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                                     model <span class="op">=</span> full_model,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                                     progressbar <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                                     random_seed <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>posteriors <span class="op">=</span> az.from_pymc3(posterior_predictive <span class="op">=</span> pps,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                           model <span class="op">=</span> full_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save posterior predictive samples</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co">#with open(output_dir+'/model/posteriors_mvt', 'wb') as post_mvt_file:</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">#    pickle.dump(posteriors, post_mvt_file)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load posterior predictive samples</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co">#with open(output_dir+'/model/posteriors_mvt', 'rb') as post_mvt_file:</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">#    posteriors = pickle.load(post_mvt_file)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Posterior Predictive Checks for the likelihood model</strong>. The observed distribution (black) is between the posterior predictive samples (blue). Each posterior predictive sample consists on a set with the same number of observations as the original data, generated based on a parameter from the posterior samples.</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>az.plot_ppc(posteriors, mean <span class="op">=</span> <span class="va">False</span>, kind <span class="op">=</span> <span class="st">'cumulative'</span>, num_pp_samples <span class="op">=</span> <span class="dv">500</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-ppccdf" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="SI2_BHGLM_files/figure-html/fig-ppccdf-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2.3: Posterior Predictive Check using the CDF.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>az.plot_ppc(posteriors, kind <span class="op">=</span> <span class="st">'scatter'</span>, mean <span class="op">=</span> <span class="va">False</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-ppcscatter" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="SI2_BHGLM_files/figure-html/fig-ppcscatter-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2.4: Posterior Predictive Check using scatterplots.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><strong>Energy plot and Bayesian Fraction of Missing Information (BFMI)</strong>. The energy plot shows similar densities between the marginal and transition energies from the Hamiltonian simulation, meaning that the sampler was not stuck in a particular area of the posterior distribution, which is validated through the BFMI values <span class="citation" data-cites="Betancourt_2017">(<a href="references.html#ref-Betancourt_2017" role="doc-biblioref">Betancourt 2017</a>)</span>.</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>az.plot_energy(full_mod, fill_color <span class="op">=</span> (<span class="st">'C0'</span>, <span class="st">'C3'</span>))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-energy" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="SI2_BHGLM_files/figure-html/fig-energy-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2.5: Energy plot and Bayesian Fraction of Missing Information.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<section id="effective-sample-sizes-autocorrelations-and-no-thinning." class="level4" data-number="2.4.1.1">
<h4 data-number="2.4.1.1" class="anchored" data-anchor-id="effective-sample-sizes-autocorrelations-and-no-thinning."><span class="header-section-number">2.4.1.1</span> Effective sample sizes, autocorrelations and no-thinning.</h4>
<p>The autocorrelation (<em>i.e.</em>, the correlation between the sample<span class="math inline">\(_i\)</span> and the sample<span class="math inline">\(_{i-1}\)</span>) directly affects the effective sample size (ess) estimation (higher autocorrelations, lower ess). For this reason, a very common practice is to thin the posterior sample (<em>i.e.</em> keep only 1 out of every k-th iteration after convergence); however, this is unadvised since it leads to a reduction in the precision of the estimates<span class="citation" data-cites="LinkEaton_2012">(<a href="references.html#ref-LinkEaton_2012" role="doc-biblioref">Link &amp; Eaton 2012</a>)</span>, making it feasible only to reduce computational requirements <span class="citation" data-cites="Stan_2022">(<a href="references.html#ref-Stan_2022" role="doc-biblioref">Team 2022</a>)</span>. Moreover, one of the advantages of using NUTS is that the samples can be uncorrelated, since the new state of the chain depends more on the probability “surface” rather than the previous position of the particle. Shown in the following autocorrelation plot:</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>rc <span class="op">=</span> {<span class="st">'plot.max_subplots'</span>: <span class="dv">120</span>}</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>az.rcParams.update(rc)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>az.plot_autocorr(full_mod, combined <span class="op">=</span> <span class="va">True</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-autocor" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="SI2_BHGLM_files/figure-html/fig-autocor-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2.6: Plots of autocorrelations of the posterior sample.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><strong>Parallel coordinates plots for each parameter of interest within the model</strong>. Shows that every sample of the posterior distribution was non-divergent. A) Mean values for each species and B) Slopes for each covariate for each species; where: 0: <em>H. dipterurus</em>, 1: <em>N. entemedor</em>, 2: <em>R. steindachneri</em></p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>az.plot_parallel(full_mod, var_names<span class="op">=</span>[<span class="st">'µ'</span>], filter_vars<span class="op">=</span><span class="st">'like'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-divmeans" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="SI2_BHGLM_files/figure-html/fig-divmeans-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2.7: Parallel coordinates plot for the means of the isotopic values.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> az.plot_parallel(full_mod, var_names <span class="op">=</span> [<span class="st">'Season'</span>, <span class="st">'Sex'</span>, <span class="st">'Maturity'</span>], filter_vars <span class="op">=</span> <span class="st">'like'</span>)<span class="op">;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(ax.get_xticklabels(), rotation<span class="op">=</span><span class="dv">70</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-divslopes" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="SI2_BHGLM_files/figure-html/fig-divslopes-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2.8: Parallel coordinates plot for the slopes of the covariates.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="a-note-on-the-interpretation-of-results" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="a-note-on-the-interpretation-of-results"><span class="header-section-number">2.5</span> A note on the interpretation of results <a class="anchor" id="interp"></a></h2>
<p>It is important to understand the interpretation of the slope of a categorical covariate before going to the description of the results. Consider a univariate model with a binary covariate (<span class="math inline">\(X\)</span>) such as the ones of this model:</p>
<p><span class="math inline">\(Y = \beta_0 + \beta_1*X + \epsilon\)</span></p>
<p><span class="math inline">\(\therefore\)</span></p>
<p>If <span class="math inline">\(X = 0\)</span>: <span class="math inline">\(Y_0 = \beta_0 + \beta_1*0 + \epsilon \implies Y_0 = \beta_0 + \epsilon\)</span></p>
<p>If <span class="math inline">\(X = 1\)</span>: <span class="math inline">\(Y_0 = \beta_0 + \beta_1*1 + \epsilon \implies Y_1 = \beta_0 + \beta_1 + \epsilon\)</span></p>
<p><em>I.e.</em>, the slope represents the difference between the means of both classes. This is demonstrabe if we substract both equations (<span class="math inline">\(\Delta_Y\)</span>):</p>
<p><span class="math inline">\(Y = \beta_0 + \beta_1 + \epsilon = \beta_0 + \epsilon \implies \Delta_Y = \beta_0 - \beta_0 + \beta_1 + \epsilon - \epsilon \therefore \Delta_Y = \beta_1\)</span></p>
<p>Taking this into account, <strong>the slopes in this work represent the difference (in ‰) between the two classes being analysed</strong>.</p>
</section>
<section id="results" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="results"><span class="header-section-number">2.6</span> Results <a class="anchor" id="resdes"></a></h2>
<section id="dummy-variables" class="level3" data-number="2.6.1">
<h3 data-number="2.6.1" class="anchored" data-anchor-id="dummy-variables"><span class="header-section-number">2.6.1</span> Dummy variables</h3>
<p>Labels for groups are assigned alphabetically, starting at 0 (<code>Python</code>’s indices start at 0): - Species: - <em>H. dipterurus</em>: 0 - <em>N. entemedor</em>: 1 - <em>R. steindachneri</em>: 2 - Season: - Cold: 0 - Warm: 1 - Sex: - Female: 0 - Male: 1 - Maturity: - Adult: 0 - Juvenile: 1</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>ref_data[<span class="st">'Species_codes'</span>] <span class="op">=</span> pd.Categorical(ref_data[<span class="st">'Species'</span>]).codes</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>ref_data[<span class="st">'Season_codes'</span>] <span class="op">=</span> pd.Categorical(ref_data[<span class="st">'Season'</span>]).codes</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>ref_data[<span class="st">'Sex_codes'</span>] <span class="op">=</span> pd.Categorical(ref_data[<span class="st">'Sex'</span>]).codes</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>ref_data[<span class="st">'Maturity_codes'</span>] <span class="op">=</span> pd.Categorical(ref_data[<span class="st">'Maturity'</span>]).codes</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>ref_data.drop(columns <span class="op">=</span> [<span class="st">'d15n'</span>, <span class="st">'d13c'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<div>


<table class="dataframe table table-sm table-striped" data-border="1">
<thead>
<tr class="header">
<th></th>
<th>Species</th>
<th>Year</th>
<th>Season</th>
<th>Sex</th>
<th>Maturity</th>
<th>Species_codes</th>
<th>Season_codes</th>
<th>Sex_codes</th>
<th>Maturity_codes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th>0</th>
<td>H.dipterurus</td>
<td>2015</td>
<td>Warm</td>
<td>Male</td>
<td>Juvenile</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<th>1</th>
<td>H.dipterurus</td>
<td>2015</td>
<td>Warm</td>
<td>Female</td>
<td>Juvenile</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<th>2</th>
<td>H.dipterurus</td>
<td>2015</td>
<td>Warm</td>
<td>Male</td>
<td>Adult</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<th>3</th>
<td>H.dipterurus</td>
<td>2015</td>
<td>Warm</td>
<td>Female</td>
<td>Juvenile</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<th>4</th>
<td>H.dipterurus</td>
<td>2015</td>
<td>Warm</td>
<td>Male</td>
<td>Adult</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<th>...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th>219</th>
<td>R.steindachneri</td>
<td>2016</td>
<td>Warm</td>
<td>Male</td>
<td>Juvenile</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<th>220</th>
<td>R.steindachneri</td>
<td>2016</td>
<td>Warm</td>
<td>Male</td>
<td>Adult</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<th>221</th>
<td>R.steindachneri</td>
<td>2016</td>
<td>Warm</td>
<td>Male</td>
<td>Adult</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<th>222</th>
<td>R.steindachneri</td>
<td>2016</td>
<td>Warm</td>
<td>Male</td>
<td>Adult</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<th>223</th>
<td>R.steindachneri</td>
<td>2016</td>
<td>Warm</td>
<td>Female</td>
<td>Adult</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>224 rows × 9 columns</p>
</div>
</div>
</div>
</section>
<section id="isotopic-means" class="level3" data-number="2.6.2">
<h3 data-number="2.6.2" class="anchored" data-anchor-id="isotopic-means"><span class="header-section-number">2.6.2</span> Isotopic means</h3>
<p>The blue trace corresponds to <em>H. dipterurus</em>, the yellow to <em>N. entemedor</em> and the green to <em>R. steindachneri</em>.</p>
<ol type="1">
<li><p><span class="math inline">\(\mu\)</span>: Posterior distribution of the means of each species for each isotope. They are among the higher levels on the hierarchy, hence including the uncertainty in the other estimates:</p>
<ul>
<li><p><span class="math inline">\(\mu_{\delta^{13}C}\)</span>: Shows the separation between species in <span class="math inline">\(\delta^{13}C\)</span>. <em>N. entemedor</em> shows intermediate values among the other two species.</p></li>
<li><p><span class="math inline">\(\mu_{\delta^{15}N}\)</span>: <em>Ídem</em>.</p></li>
</ul></li>
</ol>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>az.plot_trace(full_mod, var_names <span class="op">=</span> <span class="st">'µδ'</span>, filter_vars <span class="op">=</span> <span class="st">'like'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-tracemeans" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="SI2_BHGLM_files/figure-html/fig-tracemeans-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2.9: Trace of the isotopic means for each species.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="effect-of-the-sex" class="level3" data-number="2.6.3">
<h3 data-number="2.6.3" class="anchored" data-anchor-id="effect-of-the-sex"><span class="header-section-number">2.6.3</span> Effect of the sex</h3>
<ol start="2" type="1">
<li><span class="math inline">\(Sex\_\)</span>: Slope for the sexes of each species for each isotope.
<ul>
<li>Codes: Female = 0, Male = 1</li>
<li>The difference between sexes is small (<span class="math inline">\(\approx 0\)</span>‰).</li>
</ul></li>
</ol>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>az.plot_trace(full_mod, var_names <span class="op">=</span> <span class="st">'Sex'</span>, filter_vars <span class="op">=</span> <span class="st">'like'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-tracesex" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="SI2_BHGLM_files/figure-html/fig-tracesex-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2.10: Trace for the slope for the sex.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="effect-of-the-season" class="level3" data-number="2.6.4">
<h3 data-number="2.6.4" class="anchored" data-anchor-id="effect-of-the-season"><span class="header-section-number">2.6.4</span> Effect of the season</h3>
<ol start="3" type="1">
<li><span class="math inline">\(Season\_\)</span>: Slope for the season:
<ul>
<li>Codes: Cold = 0, Warm = 1</li>
<li><em>H. dipterurus</em>: Difference between seasons of <span class="math inline">\(\approx 1\)</span>‰ in <span class="math inline">\(\delta^{13}C\)</span> and <span class="math inline">\(\approx 2\)</span>‰ in <span class="math inline">\(\delta^{15}N\)</span>.</li>
<li><em>N. entemedor</em>: <span class="math inline">\(\Delta^{15}N \in (-1,0)\)</span>‰</li>
<li>The posterior distributions of <em>R. steindachneri</em> are very broad, possibly due to the limited sample size of three for the cold season.</li>
</ul></li>
</ol>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>az.plot_trace(full_mod, var_names <span class="op">=</span> <span class="st">'Season'</span>, filter_vars <span class="op">=</span> <span class="st">'like'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-traceseason" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="SI2_BHGLM_files/figure-html/fig-traceseason-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2.11: Trace for the slope for the seasons.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="effect-of-the-maturity-stage" class="level3" data-number="2.6.5">
<h3 data-number="2.6.5" class="anchored" data-anchor-id="effect-of-the-maturity-stage"><span class="header-section-number">2.6.5</span> Effect of the maturity stage</h3>
<ol start="4" type="1">
<li><span class="math inline">\(Maturity\_\)</span>: Slope value for the age category of each isotope for each species:
<ul>
<li>Codes: Adult = 0, Juvenile = 1</li>
<li><em>H. dipterurus</em> <span class="math inline">\(\Delta^{13}C \in (0,2)\)</span>, <span class="math inline">\(\Delta^{15}N \in (-1.5,0]\)</span></li>
<li><em>N. entemedor</em> <span class="math inline">\(\Delta^{15}N \in [-1.5,0)\)</span></li>
<li><em>R. steindachneri</em>: <span class="math inline">\(\Delta^{13}C \in (-1,0)\)</span></li>
</ul></li>
</ol>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>az.plot_trace(full_mod, var_names <span class="op">=</span> <span class="st">'Maturity'</span>, filter_vars <span class="op">=</span> <span class="st">'like'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-tracematurity" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="SI2_BHGLM_files/figure-html/fig-tracematurity-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2.12: Trace for the slope for the maturity stages.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="inference" class="level3" data-number="2.6.6">
<h3 data-number="2.6.6" class="anchored" data-anchor-id="inference"><span class="header-section-number">2.6.6</span> Inference <a class="anchor" id="inferences"></a></h3>
<p>The results are summarized and further interpreted below, evaluating the <span class="math inline">\(P(\beta \neq 0)\)</span>, based on that if <span class="math inline">\(P(\beta &lt; 0)\)</span> or <span class="math inline">\(P(\beta &gt; 0) \approx 50\%\)</span> the <span class="math inline">\(P(\beta \neq 0)\)</span> is very low (<span class="math inline">\(\sim 50\%\)</span> of the distribution on either side of 0).</p>
<section id="sexes" class="level4" data-number="2.6.6.1">
<h4 data-number="2.6.6.1" class="anchored" data-anchor-id="sexes"><span class="header-section-number">2.6.6.1</span> Sexes <a class="anchor" id="Sex"></a></h4>
<p>In general, the effect is small, with probabilities smaller than 75% in most cases. The only exception was in <span class="math inline">\(\delta^{13}C\)</span> for <em>H. dipterurus</em> with <span class="math inline">\(P(\beta &lt; 0) \approx 90\%\)</span>, suggesting that females possibly had more coastal habits than males (<span class="math inline">\(\bar{\beta} = -0.32\)</span>‰).</p>
<ul>
<li>Interpretation:
<ul>
<li><span class="math inline">\(\delta^{13}C_f = \delta^{13}C + \beta*0 = \delta^{13}C\)</span></li>
<li><span class="math inline">\(\delta^{13}C_m = \delta^{13}C + \beta*1 = \delta^{13}C - 0.32\)</span>‰; <em>i.e.</em>, males had more negative values.</li>
</ul></li>
</ul>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>az.plot_posterior(full_mod, var_names <span class="op">=</span> <span class="st">'Sex'</span>, filter_vars <span class="op">=</span> <span class="st">'like'</span>, ref_val <span class="op">=</span> <span class="dv">0</span>, hdi_prob <span class="op">=</span> <span class="fl">0.95</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-posteriorsex" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="SI2_BHGLM_files/figure-html/fig-posteriorsex-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2.13: Posterior distributions of the effect of the sex.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="season" class="level4" data-number="2.6.6.2">
<h4 data-number="2.6.6.2" class="anchored" data-anchor-id="season"><span class="header-section-number">2.6.6.2</span> Season <a class="anchor" id="Season"></a></h4>
<p>The effect of the season was more evident, with <span class="math inline">\(P(\beta &lt; 0 \lor \beta &gt; 90)\%\)</span> in most comparisons:</p>
<ul>
<li><span class="math inline">\(\delta^{13}C\)</span>:
<ul>
<li><em>H. dipterurus</em>: Cold season with less negative values than the warm season, suggesting more oceanic habits during the latter.
<ul>
<li><span class="math inline">\(\delta^{13}C_w = \delta^{13}C - \beta\)</span></li>
<li><span class="math inline">\(\delta^{13}C_c = \delta^{13}C\)</span>; cold season with less negative values.</li>
</ul></li>
</ul></li>
<li><span class="math inline">\(\delta^{15}N\)</span>: The three species showed less positive values during the cold season in relation to the warm season, which suggests that their prey had a higher trohpic position during the latter.
<ul>
<li><span class="math inline">\(\delta^{13}C_w = \delta^{13}C + \beta\)</span></li>
<li><span class="math inline">\(\delta^{13}C_c = \delta^{13}C\)</span>; cold season with less positive values.</li>
</ul></li>
</ul>
<p>The lowest <span class="math inline">\(P(\beta &lt; 0 \lor \beta &gt; 90)\%\)</span> were found for <em>N. entemedor</em> (<span class="math inline">\(P \approx 70\%\)</span>) and <em>R. steindachneri</em> (<span class="math inline">\(P \approx 60%\)</span>) in <span class="math inline">\(\delta^{13}C\)</span>.</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>az.plot_posterior(full_mod, var_names <span class="op">=</span> <span class="st">'Season'</span>, filter_vars <span class="op">=</span> <span class="st">'like'</span>, ref_val <span class="op">=</span> <span class="dv">0</span>, hdi_prob <span class="op">=</span> <span class="fl">0.95</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-posteriorseason" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="SI2_BHGLM_files/figure-html/fig-posteriorseason-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2.14: Posterior distributions of the effect of the season.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="maturity-stages" class="level4" data-number="2.6.6.3">
<h4 data-number="2.6.6.3" class="anchored" data-anchor-id="maturity-stages"><span class="header-section-number">2.6.6.3</span> Maturity stages <a class="anchor" id="Age"></a></h4>
<p>There were high probabilities of differences between age categories, with the exception of <em>R. steindachneri</em> en <span class="math inline">\(\delta^{15}N\)</span> (<span class="math inline">\(P(\beta&gt;0) \approx 56\%\)</span>). The rest of the comparisons had similar trends, in the sense that juveniles had lower values in both isotopes, suggesting more oceanic habitats and lower trophic positions. The only exception was <em>H. dipterurus</em> in <span class="math inline">\(\delta^{13}C\)</span>, whose juveniles had more coastal habits (less negative values).</p>
<ul>
<li>Interpretation a):
<ul>
<li><span class="math inline">\(\delta^{13}C\)</span>:
<ul>
<li><span class="math inline">\(\delta^{13}C_a = \delta^{13}C\)</span></li>
<li><span class="math inline">\(\delta^{13}C_j = \delta^{13}C - \beta\)</span>; juveniles had more negative values.</li>
</ul></li>
<li><span class="math inline">\(\delta^{15}N\)</span>:
<ul>
<li><span class="math inline">\(\delta^{13}C_a = \delta^{15}N\)</span></li>
<li><span class="math inline">\(\delta^{13}C_j = \delta^{15}N - \beta\)</span>; juveniles had less positive values.</li>
</ul></li>
</ul></li>
<li>Interpretation b):
<ul>
<li><span class="math inline">\(\delta^{13}C_a = \delta^{13}C\)</span></li>
<li><span class="math inline">\(\delta^{13}C_j = \delta^{13}C + \beta\)</span>; juveniles had more positive values.</li>
</ul></li>
</ul>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>az.plot_posterior(full_mod, var_names <span class="op">=</span> <span class="st">'Maturity'</span>, filter_vars <span class="op">=</span> <span class="st">'like'</span>,</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                  ref_val <span class="op">=</span> <span class="dv">0</span>, hdi_prob <span class="op">=</span> <span class="fl">0.95</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-posteriormaturity" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="SI2_BHGLM_files/figure-html/fig-posteriormaturity-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2.15: Posterior distributions of the effect of the maturity stage.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="together" class="level3" data-number="2.6.7">
<h3 data-number="2.6.7" class="anchored" data-anchor-id="together"><span class="header-section-number">2.6.7</span> Together</h3>
<p>These results can be presented in a more compact way using forest plots, where the lines represent the Highest Density Intervals (also called Credible Intervals). Thin lines represent the <span class="math inline">\(HDI_{95\%}\)</span>, thick lines the <span class="math inline">\(HDI_{50\%}\)</span>, and the points the mean of the distribution.</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>az.plot_forest(full_mod, hdi_prob <span class="op">=</span> <span class="fl">0.95</span>, var_names <span class="op">=</span> <span class="st">'_δ15N'</span>, filter_vars <span class="op">=</span> <span class="st">'like'</span>, combined <span class="op">=</span> <span class="va">True</span>)<span class="op">;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.gcf().set_size_inches(4*1.61,4.5)</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig(output_dir+'/figures/d15N_forestplot.pdf', format = 'pdf', bbox_inches = 'tight')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-forestd15n" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="SI2_BHGLM_files/figure-html/fig-forestd15n-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2.16: Forest plot of the effects of the covariates in the d15N values.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>az.plot_forest(full_mod, hdi_prob <span class="op">=</span> <span class="fl">0.95</span>, var_names <span class="op">=</span> <span class="st">'_δ13C'</span>, filter_vars <span class="op">=</span> <span class="st">'like'</span>, combined <span class="op">=</span> <span class="va">True</span>)<span class="op">;</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.gcf().set_size_inches(4*1.61,4.5)</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig(output_dir+'/figures/d13C_forestplot.pdf', format = 'pdf', bbox_inches = 'tight')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-forestd13c" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="SI2_BHGLM_files/figure-html/fig-forestd13c-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2.17: Forest plot of the effects of the covariates in the d13C values.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<section id="isotopic-mean-comparison-between-species" class="level4" data-number="2.6.7.1">
<h4 data-number="2.6.7.1" class="anchored" data-anchor-id="isotopic-mean-comparison-between-species"><span class="header-section-number">2.6.7.1</span> Isotopic mean comparison between species <a class="anchor" id="Comparisons"></a></h4>
<p>Since in the process we also estimated the posterior distributions of the means for each species, we can also directly compare them by simply substracting them:</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compare_posteriors(mod, labels,</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>                       pars <span class="op">=</span> [<span class="st">'µδ13C'</span>, <span class="st">'µδ15N'</span>],</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>                       isos <span class="op">=</span> [<span class="st">'$\delta^</span><span class="sc">{13}</span><span class="st">C$'</span>, <span class="st">'$\delta^</span><span class="sc">{15}</span><span class="st">N$'</span>],</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                       save <span class="op">=</span> <span class="va">False</span>):</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> itertools <span class="im">import</span> combinations</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get every comparison</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    spp <span class="op">=</span> [i <span class="cf">for</span> i, sp <span class="kw">in</span> <span class="bu">enumerate</span>(labels)]</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    comps <span class="op">=</span> <span class="bu">list</span>(combinations(spp, <span class="dv">2</span>))</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a figure with two spaces for each combination</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, comp <span class="kw">in</span> <span class="bu">enumerate</span>(comps):</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>        _, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize <span class="op">=</span> (<span class="dv">10</span>,<span class="dv">6</span>), constrained_layout <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>                             sharex <span class="op">=</span> <span class="va">False</span>, sharey <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># For each parameter (isotope):</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j,par <span class="kw">in</span> <span class="bu">enumerate</span>(pars):</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Calculate the difference between posterior distributions</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>            Diff <span class="op">=</span> mod.posterior[par][:,:,comp[<span class="dv">0</span>]] <span class="op">-</span> mod.posterior[par][:,:,comp[<span class="dv">1</span>]]</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Plot the difference, show the median of the distribution and P(Diff &lt; 0 or Diff &gt; 0)</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>            az.plot_posterior(Diff, ref_val <span class="op">=</span> <span class="dv">0</span>, hdi_prob <span class="op">=</span> <span class="fl">0.95</span>, point_estimate <span class="op">=</span> <span class="st">'mean'</span>, ax <span class="op">=</span> ax[j])</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Title for each panel is the isotope</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>            ax[j].set_title(<span class="ss">f'</span><span class="sc">{</span>isos[j]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>            <span class="co"># The title for each pair of comparisons is the pair of species</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>            plt.suptitle(<span class="ss">f'</span><span class="sc">{</span>labels[comp[<span class="dv">0</span>]]<span class="sc">}</span><span class="ss"> vs. </span><span class="sc">{</span>labels[comp[<span class="dv">1</span>]]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> save <span class="kw">is</span> <span class="va">True</span>:</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>                plt.gcf().set_size_inches(<span class="dv">4</span><span class="op">*</span><span class="fl">1.61</span>, <span class="dv">4</span>)</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>                plt.savefig(output_dir<span class="op">+</span><span class="st">'/figures/'</span><span class="op">+</span><span class="ss">f'</span><span class="sc">{</span>labels[comp[<span class="dv">0</span>]]<span class="sc">}</span><span class="ss"> vs. </span><span class="sc">{</span>labels[comp[<span class="dv">1</span>]]<span class="sc">}</span><span class="ss">.pdf'</span>,</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">format</span> <span class="op">=</span> <span class="st">'pdf'</span>,</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>                            bbox_inches <span class="op">=</span> <span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> forest_posteriors(mod, labels,</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>                      pars <span class="op">=</span> [<span class="st">'µδ13C'</span>, <span class="st">'µδ15N'</span>],</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                      isos <span class="op">=</span> [<span class="st">'$\delta^</span><span class="sc">{13}</span><span class="st">C$'</span>, <span class="st">'$\delta^</span><span class="sc">{15}</span><span class="st">N$'</span>],</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                      var_names <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>                      save <span class="op">=</span> <span class="va">False</span>):</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> itertools <span class="im">import</span> combinations</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> xarray <span class="im">import</span> Dataset, concat, merge</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get every comparison</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    spp <span class="op">=</span> [i <span class="cf">for</span> i, sp <span class="kw">in</span> <span class="bu">enumerate</span>(labels)]</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    comps <span class="op">=</span> <span class="bu">list</span>(combinations(spp, <span class="dv">2</span>))</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    Diffs <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    comps_sp <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j, par <span class="kw">in</span> <span class="bu">enumerate</span>(pars):</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i,comp <span class="kw">in</span> <span class="bu">enumerate</span>(comps):</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Calculate the difference between posterior distributions</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>            Diff <span class="op">=</span> mod.posterior[par][:,:,comp[<span class="dv">0</span>]] <span class="op">-</span> mod.posterior[par][:,:,comp[<span class="dv">1</span>]]</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>            Diffs.append(Diff)</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>    comps_sp <span class="op">=</span> [<span class="ss">f'</span><span class="sc">{</span>labels[comp[<span class="dv">0</span>]]<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>labels[comp[<span class="dv">1</span>]]<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> comp <span class="kw">in</span> comps]</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>    x_array <span class="op">=</span> concat(Diffs, dim <span class="op">=</span> <span class="st">'iso'</span>)</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>    x_array <span class="op">=</span> x_array.values.reshape((<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">5000</span>))</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>    x_array <span class="op">=</span>  Dataset(data_vars <span class="op">=</span> {pars[<span class="dv">0</span>]: ([<span class="st">'comp'</span>, <span class="st">'chain'</span>, <span class="st">'draw'</span>], x_array[<span class="dv">0</span>,:,:,:]),</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>                                    pars[<span class="dv">1</span>]: ([<span class="st">'comp'</span>, <span class="st">'chain'</span>, <span class="st">'draw'</span>], x_array[<span class="dv">1</span>,:,:,:])},</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>                       coords <span class="op">=</span> {<span class="st">'iso'</span>: [<span class="st">'µδ13C'</span>, <span class="st">'µδ15N'</span>], <span class="st">'comp'</span>: comps_sp})</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">#comps_sp = set(comps_sp)</span></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>    az.plot_forest(x_array, combined <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>                   <span class="co">#kind = 'ridgeplot',</span></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>                   <span class="co">#ridgeplot_alpha = 0,</span></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>                   <span class="co">#ridgeplot_truncate = False,</span></span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>                   <span class="co">#ridgeplot_quantiles = [0.05, 0.5, 0.95],</span></span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>                   hdi_prob <span class="op">=</span> <span class="fl">0.95</span>, var_names <span class="op">=</span> var_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the following figures we can observe high probabilities of mean differences in almost every comparison. Summarising:</p>
<ul>
<li><span class="math inline">\(\delta^{13}C\)</span>
<ul>
<li><em>N. entemedor</em> &gt; <em>H. dipterurus</em> (<span class="math inline">\(P = 100\%\)</span>)</li>
<li><em>H. dipterurus</em> &lt; <em>R. steindachneri</em> (<span class="math inline">\(P \approx 54.4\%\)</span>)</li>
<li><em>N. entemedor</em> &gt; <em>R. steindachneri</em> (<span class="math inline">\(P = 100\%\)</span>)</li>
</ul></li>
<li><span class="math inline">\(\delta^{15}N\)</span>
<ul>
<li><em>N. entemedor</em> &lt; <em>H. dipterurus</em> (<span class="math inline">\(P = 100\%\)</span>)</li>
<li><em>H. dipterurus</em> &gt; <em>R. steindachneri</em> (<span class="math inline">\(P \approx 100\%\)</span>)</li>
<li><em>N. entemedor</em> &gt; <em>R. steindachneri</em> (<span class="math inline">\(P = 100\%\)</span>)</li>
</ul></li>
</ul>
<div id="fig-posteriordiffs" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>compare_posteriors(mod <span class="op">=</span> full_mod,</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                   labels <span class="op">=</span> [<span class="st">'H. dipterurus'</span>, <span class="st">'N. entemedor'</span>, <span class="st">'R. steindachneri'</span>],</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                   save <span class="op">=</span> <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-posteriordiffs-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="SI2_BHGLM_files/figure-html/fig-posteriordiffs-output-1.png" class="img-fluid figure-img" data-ref-parent="fig-posteriordiffs"></p>
<p></p><figcaption class="figure-caption">(a)</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="fig-posteriordiffs-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="SI2_BHGLM_files/figure-html/fig-posteriordiffs-output-2.png" class="img-fluid figure-img" data-ref-parent="fig-posteriordiffs"></p>
<p></p><figcaption class="figure-caption">(b)</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="fig-posteriordiffs-3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="SI2_BHGLM_files/figure-html/fig-posteriordiffs-output-3.png" class="img-fluid figure-img" data-ref-parent="fig-posteriordiffs"></p>
<p></p><figcaption class="figure-caption">(c)</figcaption><p></p>
</figure>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;2.18: Posterior distributions of the differences between mean isotopic values among species.</figcaption><p></p>
</figure>
</div>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>forest_posteriors(full_mod,</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>                  labels <span class="op">=</span> [<span class="st">'HD'</span>, <span class="st">'NE'</span>, <span class="st">'RS'</span>])</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.gcf().set_size_inches(4*1.61, 4)</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig(output_dir+'/figures/mean_forestplot.pdf',</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co">#            transparent = True,</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co">#            format = 'pdf', bbox_inches = 'tight')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-posteriordiffsforest" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="SI2_BHGLM_files/figure-html/fig-posteriordiffsforest-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2.19: Forest plot of the posterior distributions of the differences between mean isotopic values among species.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="bivariate-posterior-distribution" class="level3" data-number="2.6.8">
<h3 data-number="2.6.8" class="anchored" data-anchor-id="bivariate-posterior-distribution"><span class="header-section-number">2.6.8</span> Bivariate Posterior Distribution <a class="anchor" id="PosteriorJoint"></a></h3>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_posteriors(data, mod, labels <span class="op">=</span> <span class="va">None</span>, group_col <span class="op">=</span> <span class="st">'Species'</span>, iso_cols <span class="op">=</span> [<span class="st">'d13c'</span>, <span class="st">'d15n'</span>],</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>                    palette <span class="op">=</span> <span class="st">'Paired'</span>, shade <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>                    pars <span class="op">=</span> [<span class="st">'µδ13C'</span>, <span class="st">'µδ15N'</span>], isos <span class="op">=</span> [<span class="st">'$\delta^</span><span class="sc">{13}</span><span class="st">C$'</span>, <span class="st">'$\delta^</span><span class="sc">{15}</span><span class="st">N$'</span>]):</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> matplotlib.ticker <span class="im">import</span> MaxNLocator</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># To avoid re-indexing every time</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> iso_cols[<span class="dv">0</span>]</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> iso_cols[<span class="dv">1</span>]</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Empty Data Frame to store the posterior samples</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    samples <span class="op">=</span> pd.DataFrame()</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Unique values of the group column to cicle through</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>    groups <span class="op">=</span> data[group_col].unique()</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define limits of the plot</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>    xlim <span class="op">=</span> (data[x].<span class="bu">min</span>() <span class="op">-</span> <span class="fl">0.5</span>, data[x].<span class="bu">max</span>() <span class="op">+</span> <span class="fl">0.5</span>)</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>    ylim <span class="op">=</span> (data[y].<span class="bu">min</span>() <span class="op">-</span> <span class="fl">0.5</span>, data[y].<span class="bu">max</span>() <span class="op">+</span> <span class="fl">0.5</span>)</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Form a Data Frame with the posterior samples for each isotope</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>    shape <span class="op">=</span> mod.posterior[pars[<span class="dv">0</span>]].shape</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> group <span class="kw">in</span> groups:</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>            temp <span class="op">=</span> pd.DataFrame({<span class="st">'d13c'</span>:mod.posterior[pars[<span class="dv">0</span>]][:,:,group].values.reshape(shape[<span class="dv">0</span>]<span class="op">*</span>shape[<span class="dv">1</span>]),</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">'d15n'</span>:mod.posterior[pars[<span class="dv">1</span>]][:,:,group].values.reshape(shape[<span class="dv">0</span>]<span class="op">*</span>shape[<span class="dv">1</span>]),</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>                                 group_col: group})</span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>            samples <span class="op">=</span> samples.append(temp, ignore_index <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>    samples <span class="op">=</span> samples.reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Map value labels to a new column (if provided)</span></span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(labels) <span class="kw">is</span> <span class="bu">dict</span>:</span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">'Group'</span>] <span class="op">=</span> data[group_col].<span class="bu">map</span>(labels)</span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>        samples[<span class="st">'Group'</span>] <span class="op">=</span> samples[group_col].<span class="bu">map</span>(labels)</span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a>        group_col <span class="op">=</span> <span class="st">'Group'</span></span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the joint posterior distribution and its marginals</span></span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a>    grid <span class="op">=</span> sns.JointGrid(x <span class="op">=</span> x, y <span class="op">=</span> y, data <span class="op">=</span> data, xlim <span class="op">=</span> xlim, ylim <span class="op">=</span> ylim)</span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> grid.plot_joint(sns.scatterplot, hue <span class="op">=</span> group_col, palette <span class="op">=</span> palette, data <span class="op">=</span> data, alpha <span class="op">=</span> <span class="fl">0.7</span>)</span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true" tabindex="-1"></a>    sns.kdeplot(x <span class="op">=</span> samples[iso_cols[<span class="dv">0</span>]], shade <span class="op">=</span> <span class="va">True</span>, thresh <span class="op">=</span> <span class="fl">0.05</span>, hue <span class="op">=</span> samples[group_col], </span>
<span id="cb46-40"><a href="#cb46-40" aria-hidden="true" tabindex="-1"></a>                ax <span class="op">=</span> g.ax_marg_x, palette <span class="op">=</span> palette, legend <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb46-41"><a href="#cb46-41" aria-hidden="true" tabindex="-1"></a>    sns.kdeplot(y <span class="op">=</span> samples[iso_cols[<span class="dv">1</span>]], shade <span class="op">=</span> <span class="va">True</span>, thresh <span class="op">=</span> <span class="fl">0.05</span>, hue <span class="op">=</span> samples[group_col], </span>
<span id="cb46-42"><a href="#cb46-42" aria-hidden="true" tabindex="-1"></a>                ax <span class="op">=</span> g.ax_marg_y, palette <span class="op">=</span> palette, legend <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb46-43"><a href="#cb46-43" aria-hidden="true" tabindex="-1"></a>    sns.kdeplot(x <span class="op">=</span> samples[iso_cols[<span class="dv">0</span>]], y <span class="op">=</span> samples[iso_cols[<span class="dv">1</span>]], shade <span class="op">=</span> shade, thresh <span class="op">=</span> <span class="fl">0.05</span>, </span>
<span id="cb46-44"><a href="#cb46-44" aria-hidden="true" tabindex="-1"></a>                hue <span class="op">=</span> samples[group_col], palette <span class="op">=</span> palette, legend <span class="op">=</span> <span class="va">True</span>, cbar<span class="op">=</span> <span class="va">False</span>, </span>
<span id="cb46-45"><a href="#cb46-45" aria-hidden="true" tabindex="-1"></a>                alpha <span class="op">=</span> <span class="fl">0.7</span>, ax <span class="op">=</span> g.ax_joint)</span>
<span id="cb46-46"><a href="#cb46-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-47"><a href="#cb46-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Change the appearance of the plot</span></span>
<span id="cb46-48"><a href="#cb46-48" aria-hidden="true" tabindex="-1"></a>    g.ax_joint.set_xlabel(isos[<span class="dv">0</span>])</span>
<span id="cb46-49"><a href="#cb46-49" aria-hidden="true" tabindex="-1"></a>    g.ax_joint.set_ylabel(isos[<span class="dv">1</span>])</span>
<span id="cb46-50"><a href="#cb46-50" aria-hidden="true" tabindex="-1"></a>    g.ax_joint.xaxis.set_major_locator(MaxNLocator(<span class="dv">5</span>))</span>
<span id="cb46-51"><a href="#cb46-51" aria-hidden="true" tabindex="-1"></a>    g.ax_joint.yaxis.set_major_locator(MaxNLocator(<span class="dv">5</span>))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Given that both isotopes were modeled at the same time, we can plot the joint posterior mean distribution, which is non-orhtogonal as if both isotopes were independent from one another (separate Generalized Linear Models or independent null hypothesis testing). It is important to remark that the means are not in the centroid of each group. This is a favorable consequence of having used Student-T distributions for the parameters and likelihood instead of normal distributions. By stablishing that extreme values have a higher probability than in a normal distribution, the effect of the more extreme values is disregarded or, in another words, in a normal distribution they have low probabilities and, hence, each point is given a heavier weight.</p>
<p>This consequence is why using heavy-tailed distributions is called robust regression. In <a href="https://twiecki.io/blog/2013/08/27/bayesian-glms-2/">this example</a> the effect is shown in a linear regression with a continuous covariate, in which the robust estimation of the parameters is not “deceived” by the more extreme values on the y variable and posterior predictive lines are closer to the real line than those of the “normal” regression.</p>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>plot_posteriors(data <span class="op">=</span> glm_data, mod <span class="op">=</span> full_mod,</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>                labels <span class="op">=</span> {<span class="dv">0</span>: <span class="st">'H. dipterurus'</span>, <span class="dv">1</span>: <span class="st">'N. entemedor'</span>, <span class="dv">2</span>: <span class="st">'R. steindachneri'</span>},</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>                palette <span class="op">=</span> colors[<span class="dv">0</span>:<span class="dv">3</span>])</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.gcf().set_size_inches(4, 4*1.61)</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig(output_dir+'/figures/posterior_means.pdf', format = 'pdf', bbox_inches = 'tight')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-posteriorbiv" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="SI2_BHGLM_files/figure-html/fig-posteriorbiv-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2.20: Bivariate posterior distributions of the mean isotopic values.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>End of notebook</p>
</div>
</div>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext watermark</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>watermark <span class="op">-</span>n <span class="op">-</span>u <span class="op">-</span>v <span class="op">-</span>iv <span class="op">-</span>w</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Last updated: Sat Jun 03 2023

Python implementation: CPython
Python version       : 3.8.6
IPython version      : 7.19.0

seaborn   : 0.11.0
matplotlib: 3.3.3
numpy     : 1.19.4
pymc3     : 3.11.2
arviz     : 0.11.2
theano    : 1.1.2
pandas    : 1.1.5

Watermark: 2.1.0
</code></pre>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-Armheinetal_2019" class="csl-entry" role="doc-biblioentry">
Armhein V, Greenland S, McShane B (2019) <a href="https://doi.org/10.1038/d41586-019-00857-9.">Scientists Rise up Against Statistical Significance</a>. Nature 567:305–307.
</div>
<div id="ref-Betancourt_2017" class="csl-entry" role="doc-biblioentry">
Betancourt M (2017) <span class="nocase">A conceptual introduction to Hamiltonian Monte Carlo</span>. arXiv preprint 1701.02434.
</div>
<div id="ref-Bolstad_2004" class="csl-entry" role="doc-biblioentry">
Bolstad WM (2004) Introduction to bayesian statistics. Wiley-Interscience, New Jersey, USA.
</div>
<div id="ref-Ellison_2004" class="csl-entry" role="doc-biblioentry">
Ellison AM (2004) <a href="https://doi.org/10.1111/j.1461-0248.2004.00603.x">Bayesian Inference in Ecology</a>. Ecology Letters 7:509–520.
</div>
<div id="ref-Gabryetal_2017" class="csl-entry" role="doc-biblioentry">
Gabry J, Simpson D, Vehtari A, Betancourt M, Gelman A (2017) <a href="https://doi.org/10.1111/rssa.12378"><span class="nocase">Visualization in Bayesian workflow</span></a>. arXiv preprint 1709.01449.
</div>
<div id="ref-Gerrodette_2011" class="csl-entry" role="doc-biblioentry">
Gerrodette T (2011) <a href="https://doi.org/10.1111/j.1439-0485.2011.00466.x">Inference Without Significance: Measuring Support for Hypotheses Rather Than Rejecting Them</a>. Marine Ecology 32:404–418.
</div>
<div id="ref-HobbsHilborn_2006" class="csl-entry" role="doc-biblioentry">
Hobbs NT, Hilborn R (2006) <a href="">Alternatives to Statistical Hypothesis Testing in Ecology: A Guide to Self Teaching</a>. Ecological Applications 16:5–19.
</div>
<div id="ref-Jacksonetal_2011" class="csl-entry" role="doc-biblioentry">
Jackson AL, Inger R, Parnell AC, Bearhop S (2011) Comparing Isotopic Niche Widths Among and Within Communities: <span>SIBER</span>-Stable Isotope <span>Bayesian</span> Ellipses in <span>R</span>. Journal of Animal Ecology 34:595–602.
</div>
<div id="ref-Kruschke_2012" class="csl-entry" role="doc-biblioentry">
Kruschke JK (2012) <a href="https://doi.org/10.1037/a0029146">Bayesian Estimation Supersedes the t Test</a>. Journal of Experimental Psychology: General 142:573–603.
</div>
<div id="ref-Kruschke_2015" class="csl-entry" role="doc-biblioentry">
Kruschke JK (2015) Doing bayesian data analysis: A tutorial with r, JAGS, and stan, 2nd ed. Academic Press, London, UK.
</div>
<div id="ref-Lewandowskietal_2009" class="csl-entry" role="doc-biblioentry">
Lewandowski D, Kurowicka D, Joe H (2009) <a href="https://doi.org/10.1016/j.jmva.2009.04.008">Generating Random Correlation Matrices Based on Vines and Extended Onion Method</a>. Journal of Multivariate Analysis 100:1989–2001.
</div>
<div id="ref-LinkEaton_2012" class="csl-entry" role="doc-biblioentry">
Link WA, Eaton MJ (2012) <a href="https://doi.org/10.1111/j.2041-210X.2011.00131.x">On Thinning of Chains in MCMC</a>. Methods in Ecology and Evolution 3:112–115.
</div>
<div id="ref-Martin_2018" class="csl-entry" role="doc-biblioentry">
Martin O (2018) Bayesian analysis with python: Introduction to statistical modeling and probabilistic programming using PyMC3 and ArviZ, 2nd ed. Pakt Publishing.
</div>
<div id="ref-ParkCasella_2012" class="csl-entry" role="doc-biblioentry">
Park T, Casella G (2012) <a href="https://doi.org/10.1198/016214508000000337"><span>The Bayesian Lasso</span></a>. Journal of the American Statistical Association 103:681–686.
</div>
<div id="ref-Salvatieretal_2016" class="csl-entry" role="doc-biblioentry">
Salvatier J, Wiecki TV, Fonnesbeck C (2016) <a href="https://doi.org/10.7717/peerj-cs.55."><span class="nocase">Probabilistic programming in Python using PyMC3</span></a>. PeerJ Computer Science 2:e55.
</div>
<div id="ref-Stan_2022" class="csl-entry" role="doc-biblioentry">
Team SD (2022) Stan modeling language user’s guide and reference manual. <a href="https://mc-stan.org/docs/reference-manual/effective-sample-size.html">https://mc-stan.org/docs/reference-manual/effective-sample-size.html</a>
</div>
<div id="ref-VanRossumetal_2009" class="csl-entry" role="doc-biblioentry">
Van Rossum G, Drake FL (2009) Python 3 reference manual. CreateSpace, Scotts Valley, CA.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./SI1_ML_counts.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">ML approach to classify species based on prey weights</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./SI3_SIBER.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Amplitudes and comparisons of the isotopic niches</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>